<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>
            급식
        </title>
        <link rel="stylesheet" href="./css/index.css" type="text/css">
        <script>
            function dateFormat(date){
                var date = new Date();
                var year = date.getFullYear();
                var month = ("0" + (1 + date.getMonth())).slice(-2);
                var day = ("0" + date.getDate()).slice(-2);
            
                return year + month + day;
            }

            function update(date){
                url = "https://api.skybro2004.com/meal?date=" + date
                const config = {
                    headers: {
                        'Accept' : 'application/json'
                    }
                }
                fetch(url, config)
                    .then(res => {
                        console.log(res)
                        return res.json()
                    })
                    .then(data => {
                        console.log(data)
                        document.getElementsByClassName("meal-main-list")[0].innerHTML = ""
                        document.getElementById("date").innerText = date
                        if(data.code==200){
                            var mealList = document.getElementsByClassName("meal-main-list")[0]
                            for(const item of data.meal){
                                console.log(item)
                                var temp = document.createElement('li')
                                temp.className = "meal-main-list-item"
                                temp.innerHTML = item
                                mealList.appendChild(temp)
                            }
                            document.getElementsByClassName("meal-footer-kcal")[0].innerHTML = data.cal
                        }
                        else if(data.code==404){
                            document.getElementsByClassName("meal-main-list")[0].innerHTML = "급식이 없어요!"
                            document.getElementsByClassName("meal-footer-kcal")[0].innerHTML = "- Kcal"
                        }
                        else{
                            console.log(data.code)
                            document.write("error : ", data.code)
                        }
                    })
            }
            
            function prevDay(){
                jsdate.setDate(jsdate.getDate() - 1)
                date = String(jsdate.getFullYear()) + (jsdate.getMonth() + 1).toString().padStart(2,'0') + jsdate.getDate().toString().padStart(2,'0')
                update(date)
            }

            function nextDay(){
                jsdate.setDate(jsdate.getDate() + 1)
                date = String(jsdate.getFullYear()) + (jsdate.getMonth() + 1).toString().padStart(2,'0') + jsdate.getDate().toString().padStart(2,'0')
                update(date)
            }
        </script>
    </head>
    <body class="body-meal">


        <main class="main-meal">
            <div class="meal">
                <div class="meal-header">
                    <div class="meal-header-date">
                        <button id="prev" onclick="prevDay();">&lt;</button>
                        <button id="date">날짜선택</button>
                        <button id="next" onclick="nextDay();">&gt;</button>
                    </div>
                </div>
                
                <div class="meal-main">
                    <ul class="meal-main-list">
                        <li class="meal-main-list-item">
                            급식이 없어요!
                        </li>
                    </ul>
                </div>
                <div class="meal-footer">
                    <p class="meal-footer-kcal">- Kcal</p>
                </div>
            </div>
        </main>

        <script>
            var jsdate = new Date()
            var date = String(jsdate.getFullYear()) + (jsdate.getMonth() + 1).toString().padStart(2,'0') + jsdate.getDate().toString().padStart(2,'0')
            update(date)
        </script>
    </body>
</html>


<!--https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=028278aaacd242438668d46a5464e934&Type=json&pIndex=1&pSize=31&ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=7530081&MLSV_FROM_YMD=20210917&MLSV_TO_YMD=20210917-->
