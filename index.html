<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>
            시간표
        </title>
        <style>
            table {
                border-collapse: collapse;
                border: 1px solid black;
            }
            td{
                width: 80px;
                height: 40px;
                text-align: center;
                border: 1px solid black;
            }
            .select{
                background-color: yellow;
                /*color: yellowgreen;*/
            }
        </style>
        <script>
            function launch(){
                location.href = "../meal"
            }

            function getToday(){
                var date = new Date();
                var year = date.getFullYear();
                var month = ("0" + (1 + date.getMonth())).slice(-2);
                var day = ("0" + date.getDate()).slice(-2);
            
                return year + month + day;
            }

            function format(){
                var args = Array.prototype.slice.call (arguments, 1)
                return arguments[0].replace (/\{(\d+)\}/g, function (match, index){
                    return args[index];
                });
            }

            function update(date){
                clear()
                var url = 'http://api.skybro2004.com/schedular?date=' + date
                const config = {
                    headers: {
                        'Accept' : 'application/json'
                    }
                }
                fetch(url, config)
                    .then(res => {
                        console.log(res)
                        return res.json()
                    })
                    .then(data => {
                        console.log("data")
                        console.log(data)
                        console.log("code : ", data.code)
                        if(data.code==200){
                            for(const item of data.data){
                                console.log(item.weekday_str + item.period + "|" + item.item);
                                //document.write(item)
                                document.getElementById(String(item.weekday_str + item.period)).innerHTML = item.item
                            }
                            var dateFrom = data.header.dateFrom
                            var dateTo = data.header.dateTo
                            document.getElementById("week").innerHTML = format("{0}월 {1}일 ~ {2}월 {3}일 시간표", dateFrom.substr(4, 2), dateFrom.substr(6, 2), dateTo.substr(4, 2), dateTo.substr(6, 2))
                        }
                    })
                    .catch(err => {
                        console.log("error")
                        console.log(err)
                    })
            }

            function clear(){
                for(var weekday of ["MON", "TUE", "WED", "THU", "FRI"]){
                    for(var period=1; period<8; period++){
                        console.log(weekday + period)
                        document.getElementById(String(weekday + period)).innerHTML = " "
                    }
                }

            }

            function nextWeek(){
                jsdate.setDate(jsdate.getDate() + 7)
                date = String(jsdate.getFullYear()) + jsdate.getMonth().toString().padStart(2,'0') + jsdate.getDate().toString().padStart(2,'0')
                console.log(date, jsdate)
                try{
                    update(date)
                }
                catch{
                    alert("시간표가 없어요!")
                }
            }

            function prevWeek(){
                jsdate.setDate(jsdate.getDate() - 7)
                date = String(jsdate.getFullYear()) + jsdate.getMonth().toString().padStart(2,'0') + jsdate.getDate().toString().padStart(2,'0')
                console.log(date, jsdate)
                update(date)
            }
        </script>
    </head>
    <body>
        



        <table class="schedular_table">
            <tr>
                <td colspan="6">
                    <button onclick="prevWeek();"><</button>
                    <label id="week">무슨무슨날 시간표</label>
                    <button onclick="nextWeek();">></button>
                </td>
            </tr>
            <tr>
                <td> / </td>

                <td>월요일</td>
                <td>화요일</td>
                <td>수요일</td>
                <td>목요일</td>
                <td>금요일</td>
            </tr>
            <tr>
                <td>1교시</td>

                <td id="MON1"></td>
                <td id="TUE1"></td>
                <td id="WED1"></td>
                <td id="THU1"></td>
                <td id="FRI1"></td>
            </tr>
            <tr>
                <td>2교시</td>

                <td id="MON2"></td>
                <td id="TUE2"></td>
                <td id="WED2"></td>
                <td id="THU2"></td>
                <td id="FRI2"></td>
            </tr>
            <tr>
                <td>3교시</td>

                <td id="MON3"></td>
                <td id="TUE3"></td>
                <td id="WED3"></td>
                <td id="THU3"></td>
                <td id="FRI3"></td>
            </tr>
            <tr>
                <td>4교시</td>

                <td id="MON4"></td>
                <td id="TUE4"></td>
                <td id="WED4"></td>
                <td id="THU4"></td>
                <td id="FRI4"></td>
            </tr>
            <tr>
                <td>점심시간</td>

                <td colspan="5">
                    <a href="javascript:launch()">오늘 급식!</button>
                </td>
            </tr>
            <tr>
                <td>5교시</td>

                <td id="MON5"></td>
                <td id="TUE5"></td>
                <td id="WED5"></td>
                <td id="THU5"></td>
                <td id="FRI5"></td>
            </tr>
            <tr>
                <td>6교시</td>

                <td id="MON6"></td>
                <td id="TUE6"></td>
                <td id="WED6"></td>
                <td id="THU6"></td>
                <td id="FRI6"></td>
            </tr>
            <tr>
                <td>7교시</td>

                <td id="MON7"></td>
                <td id="TUE7"></td>
                <td id="WED7"></td>
                <td id="THU7"></td>
                <td id="FRI7"></td>
            </tr>
        </table>

        <script>
            var date = getToday()
            var jsdate = new Date(date.substr(0, 4), date.substr(4, 2), date.substr(6, 2))
            update(date)
            clear()
        </script>
    </body>
</html>

<!--https://open.neis.go.kr/hub/hisTimetable?KEY=028278aaacd242438668d46a5464e934&Type=json&ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=7530081&GRADE=2&CLASS_NM=8&TI_FROM_YMD=20210920&TI_TO_YMD=20210925-->
